mkdir "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack"
mkdir "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack\Upgrade"

Copy-Item "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\*.*" "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack"
Copy-Item "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\DbUp" "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack" -Recurse
Copy-Item "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\Logs" "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack" -Recurse
Copy-Item "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\bin\$(buildConfiguration)\*.*" "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack" -Recurse

$upgradePath = "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\Upgrade\$(releaseno).0"
if (Test-Path $upgradePath) {
  Copy-Item "$upgradePath\*.*" "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack\Upgrade" -Recurse
}
else {
  Write-Host "Upgrade folder $upgradePath does not exist. Skipping copy."
}

Remove-Item "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack\*.cs" -Recurse -Force
Remove-Item "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack\*.csproj" -Recurse -Force
Remove-Item "$(System.DefaultWorkingDirectory)\src\Endava.RSACQE.Database\pack\*.csproj.vspscc" -Recurse -Force
