- task: SonarQubePrepare@4
  env:
    NX_SKIP_CACHE: true 
  displayName: 'Prepare analysis on SonarQube'
  inputs:
    SonarQube: 'SonarQube_Service'
    scannerMode: CLI
    configMode: manual
    cliProjectKey: GeoRiskMaps
    cliProjectName: GeoRiskMaps
    cliProjectVersion: '$(Build.BuildNumber)'
    cliSources: 'packages\maps-ui\src'
    extraProperties: |
      sonar.ts.tsconfigPath=$(Build.SourcesDirectory)/tsconfig.base.json
      sonar.language=ts
      sonar.exclusions=**/*.spec.ts, **/*.module.ts, **/*.routes.ts, **/*.main.ts, **/*.setupJest.ts, **/*.environment.*.ts, **/*.popup.service.ts, **/*.map-sync.service.ts, **/.nx/**
      sonar.javascript.lcov.reportPaths=coverage/packages/maps-ui/lcov.info
      sonar.testExecutionReportPaths=testResults/sonar-report.xml 
      sonar.tests=packages\maps-ui\src
      sonar.test.inclusions=**/*.spec.ts
      sonar.branch.name=$(Build.SourceBranchName)
      sonar.coverage.exclusions=**/.nx/**
      sonar.inclusions=packages/maps-ui/**

- task: SonarQubeAnalyze@4
  env:
    NX_SKIP_CACHE: true 
  displayName: 'Run Code Analysis'
  continueOnError: true
